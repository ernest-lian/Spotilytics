import sys
import os
cwd = os.getcwd()
sys.path.append(os.path.join(os.path.dirname(__file__), '../../..'))

import unittest
import requests
import json

from backend.src.dashboard_model.dashboard_model import store_top_artists, store_top_tracks
from backend.src.users_model.users_model import create_user
from backend.src.app import init_db

class TestDashboardMethods(unittest.TestCase):
    def setUp(self):
        init_db()

    def test_store_top_artists(self):
        user_id = 'cc88f8b2-aa13-11ea-9dc5-acbc3282522f'
        top_artists = {'items': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/66CXWjxzNUsdJxJ2JdwvnR'}, 'followers': {'href': None, 'total': 46338149}, 'genres': ['dance pop', 'pop', 'post-teen pop'], 'href': 'https://api.spotify.com/v1/artists/66CXWjxzNUsdJxJ2JdwvnR', 'id': '66CXWjxzNUsdJxJ2JdwvnR', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/b1dfbe843b0b9f54ab2e588f33e7637d2dab065a', 'width': 640}, {'height': 320, 'url': 'https://i.scdn.co/image/b189cb24f45db92780d1aa6c81aee69b8defa03a', 'width': 320}, {'height': 160, 'url': 'https://i.scdn.co/image/3c4516cf74d09cf93db7536ce8826df28fba4156', 'width': 160}], 'name': 'Ariana Grande', 'popularity': 95, 'type': 'artist', 'uri': 'spotify:artist:66CXWjxzNUsdJxJ2JdwvnR'}, {'external_urls': {'spotify': 'https://open.spotify.com/artist/00FQb4jTyendYWaN8pK0wa'}, 'followers': {'href': None, 'total': 10505020}, 'genres': ['art pop', 'pop'], 'href': 'https://api.spotify.com/v1/artists/00FQb4jTyendYWaN8pK0wa', 'id': '00FQb4jTyendYWaN8pK0wa', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/6e8dc460cfb6b89d7970302259febd0aa73b38c6', 'width': 640}, {'height': 320, 'url': 'https://i.scdn.co/image/bcdee6b17410b5d27d40bc114757e38125b00c84', 'width': 320}, {'height': 160, 'url': 'https://i.scdn.co/image/0c50e5ae217b7a86f9f5114dc5e0f1beb8e9185d', 'width': 160}], 'name': 'Lana Del Rey', 'popularity': 86, 'type': 'artist', 'uri': 'spotify:artist:00FQb4jTyendYWaN8pK0wa'}, {'external_urls': {'spotify': 'https://open.spotify.com/artist/26VFTg2z8YR0cCuwLzESi2'}, 'followers': {'href': None, 'total': 10717309}, 'genres': ['dance pop', 'electropop', 'etherpop', 'indie poptimism', 'pop', 'post-teen pop'], 'href': 'https://api.spotify.com/v1/artists/26VFTg2z8YR0cCuwLzESi2', 'id': '26VFTg2z8YR0cCuwLzESi2', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/1ccc88afcd13131dc35a1bd028922dbc748a55fb', 'width': 640}, {'height': 320, 'url': 'https://i.scdn.co/image/8b56979f115e855301c33828bcad2c57280adbab', 'width': 320}, {'height': 160, 'url': 'https://i.scdn.co/image/ac0a244c45f25b7d177bbe629c30565fe0768f14', 'width': 160}], 'name': 'Halsey', 'popularity': 91, 'type': 'artist', 'uri': 'spotify:artist:26VFTg2z8YR0cCuwLzESi2'}, {'external_urls': {'spotify': 'https://open.spotify.com/artist/7tYKF4w9nC0nq9CsPZTHyP'}, 'followers': {'href': None, 'total': 3330493}, 'genres': ['pop', 'pop rap', 'rap'], 'href': 'https://api.spotify.com/v1/artists/7tYKF4w9nC0nq9CsPZTHyP', 'id': '7tYKF4w9nC0nq9CsPZTHyP', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/e1e46c441024525643a19402b3a12188de219420', 'width': 640}, {'height': 320, 'url': 'https://i.scdn.co/image/5e23d0ad32a6f75db6b3666082d0a8e60132ddd9', 'width': 320}, {'height': 160, 'url': 'https://i.scdn.co/image/92512e953dcac544a48dc9a3e331725ea65ccff2', 'width': 160}], 'name': 'SZA', 'popularity': 82, 'type': 'artist', 'uri': 'spotify:artist:7tYKF4w9nC0nq9CsPZTHyP'}, {'external_urls': {'spotify': 'https://open.spotify.com/artist/41MozSoPIsD1dJM0CLPjZF'}, 'followers': {'href': None, 'total': 12158098}, 'genres': ['k-pop', 'k-pop girl group'], 'href': 'https://api.spotify.com/v1/artists/41MozSoPIsD1dJM0CLPjZF', 'id': '41MozSoPIsD1dJM0CLPjZF', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/254b0e0fc1d4cf39de56960ed983c1ff7e3dff00', 'width': 640}, {'height': 320, 'url': 'https://i.scdn.co/image/5f52e025177c168da1dd61dc3f264e37588831d7', 'width': 320}, {'height': 160, 'url': 'https://i.scdn.co/image/6d088fb12fc7a71315edccf87a02c3d3b13952a7', 'width': 160}], 'name': 'BLACKPINK', 'popularity': 85, 'type': 'artist', 'uri': 'spotify:artist:41MozSoPIsD1dJM0CLPjZF'}], 'total': 50, 'limit': 5, 'offset': 0, 'href': 'https://api.spotify.com/v1/me/top/artists?limit=5&offset=0&time_range=long_term', 'previous': None, 'next': 'https://api.spotify.com/v1/me/top/artists?limit=5&offset=5&time_range=long_term'}
        response = store_top_artists(user_id, top_artists)

        self.assertEqual(len(response), 5)

    def test_store_top_tracks(self):
        user_id = '447ae3d0-aa14-11ea-b641-acbc3282522f'
        top_tracks = {'items': [{'album': {'album_type': 'ALBUM', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/66CXWjxzNUsdJxJ2JdwvnR'}, 'href': 'https://api.spotify.com/v1/artists/66CXWjxzNUsdJxJ2JdwvnR', 'id': '66CXWjxzNUsdJxJ2JdwvnR', 'name': 'Ariana Grande', 'type': 'artist', 'uri': 'spotify:artist:66CXWjxzNUsdJxJ2JdwvnR'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'external_urls': {'spotify': 'https://open.spotify.com/album/3tx8gQqWbGwqIGZHqDNrGe'}, 'href': 'https://api.spotify.com/v1/albums/3tx8gQqWbGwqIGZHqDNrGe', 'id': '3tx8gQqWbGwqIGZHqDNrGe', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/ab67616d0000b273c3af0c2355c24ed7023cd394', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/ab67616d00001e02c3af0c2355c24ed7023cd394', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/ab67616d00004851c3af0c2355c24ed7023cd394', 'width': 64}], 'name': 'Sweetener', 'release_date': '2018-08-17', 'release_date_precision': 'day', 'total_tracks': 15, 'type': 'album', 'uri': 'spotify:album:3tx8gQqWbGwqIGZHqDNrGe'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/66CXWjxzNUsdJxJ2JdwvnR'}, 'href': 'https://api.spotify.com/v1/artists/66CXWjxzNUsdJxJ2JdwvnR', 'id': '66CXWjxzNUsdJxJ2JdwvnR', 'name': 'Ariana Grande', 'type': 'artist', 'uri': 'spotify:artist:66CXWjxzNUsdJxJ2JdwvnR'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'disc_number': 1, 'duration_ms': 171333, 'explicit': True, 'external_ids': {'isrc': 'USUM71808586'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/3NbTQ8ZbHU6MSEVUFAVCJ9'}, 'href': 'https://api.spotify.com/v1/tracks/3NbTQ8ZbHU6MSEVUFAVCJ9', 'id': '3NbTQ8ZbHU6MSEVUFAVCJ9', 'is_local': False, 'name': 'better off', 'popularity': 67, 'preview_url': 'https://p.scdn.co/mp3-preview/11414bf495a02a42a33c9cd66a23612513da3a50?cid=db3cb208eea947b9b5115eaba840402e', 'track_number': 12, 'type': 'track', 'uri': 'spotify:track:3NbTQ8ZbHU6MSEVUFAVCJ9'}, {'album': {'album_type': 'ALBUM', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/3HqSLMAZ3g3d5poNaI7GOU'}, 'href': 'https://api.spotify.com/v1/artists/3HqSLMAZ3g3d5poNaI7GOU', 'id': '3HqSLMAZ3g3d5poNaI7GOU', 'name': 'IU', 'type': 'artist', 'uri': 'spotify:artist:3HqSLMAZ3g3d5poNaI7GOU'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'external_urls': {'spotify': 'https://open.spotify.com/album/5V8n6fqyAPxvFTibPhQVcp'}, 'href': 'https://api.spotify.com/v1/albums/5V8n6fqyAPxvFTibPhQVcp', 'id': '5V8n6fqyAPxvFTibPhQVcp', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/ab67616d0000b273c06f0e8b33ac2d246158253e', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/ab67616d00001e02c06f0e8b33ac2d246158253e', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/ab67616d00004851c06f0e8b33ac2d246158253e', 'width': 64}], 'name': 'Palette', 'release_date': '2017-04-21', 'release_date_precision': 'day', 'total_tracks': 10, 'type': 'album', 'uri': 'spotify:album:5V8n6fqyAPxvFTibPhQVcp'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/3HqSLMAZ3g3d5poNaI7GOU'}, 'href': 'https://api.spotify.com/v1/artists/3HqSLMAZ3g3d5poNaI7GOU', 'id': '3HqSLMAZ3g3d5poNaI7GOU', 'name': 'IU', 'type': 'artist', 'uri': 'spotify:artist:3HqSLMAZ3g3d5poNaI7GOU'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'disc_number': 1, 'duration_ms': 253293, 'explicit': False, 'external_ids': {'isrc': 'KRA381700868'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/3P3UA61WRQqwCXaoFOTENd'}, 'href': 'https://api.spotify.com/v1/tracks/3P3UA61WRQqwCXaoFOTENd', 'id': '3P3UA61WRQqwCXaoFOTENd', 'is_local': False, 'name': 'Through the Night', 'popularity': 67, 'preview_url': 'https://p.scdn.co/mp3-preview/0ac605bf88a54a00e36ec558cdfab959781ba2fd?cid=db3cb208eea947b9b5115eaba840402e', 'track_number': 8, 'type': 'track', 'uri': 'spotify:track:3P3UA61WRQqwCXaoFOTENd'}, {'album': {'album_type': 'ALBUM', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/7tYKF4w9nC0nq9CsPZTHyP'}, 'href': 'https://api.spotify.com/v1/artists/7tYKF4w9nC0nq9CsPZTHyP', 'id': '7tYKF4w9nC0nq9CsPZTHyP', 'name': 'SZA', 'type': 'artist', 'uri': 'spotify:artist:7tYKF4w9nC0nq9CsPZTHyP'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'external_urls': {'spotify': 'https://open.spotify.com/album/76290XdXVF9rPzGdNRWdCh'}, 'href': 'https://api.spotify.com/v1/albums/76290XdXVF9rPzGdNRWdCh', 'id': '76290XdXVF9rPzGdNRWdCh', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/ab67616d0000b2734c79d5ec52a6d0302f3add25', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/ab67616d00001e024c79d5ec52a6d0302f3add25', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/ab67616d000048514c79d5ec52a6d0302f3add25', 'width': 64}], 'name': 'Ctrl', 'release_date': '2017-06-09', 'release_date_precision': 'day', 'total_tracks': 14, 'type': 'album', 'uri': 'spotify:album:76290XdXVF9rPzGdNRWdCh'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/7tYKF4w9nC0nq9CsPZTHyP'}, 'href': 'https://api.spotify.com/v1/artists/7tYKF4w9nC0nq9CsPZTHyP', 'id': '7tYKF4w9nC0nq9CsPZTHyP', 'name': 'SZA', 'type': 'artist', 'uri': 'spotify:artist:7tYKF4w9nC0nq9CsPZTHyP'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'disc_number': 1, 'duration_ms': 181120, 'explicit': True, 'external_ids': {'isrc': 'USRC11701110'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/5wTVNpi5WDByxBgKgUE6MU'}, 'href': 'https://api.spotify.com/v1/tracks/5wTVNpi5WDByxBgKgUE6MU', 'id': '5wTVNpi5WDByxBgKgUE6MU', 'is_local': False, 'name': 'Supermodel', 'popularity': 64, 'preview_url': 'https://p.scdn.co/mp3-preview/f37d94fc4ba9668758ce4b5b1ec3e6a51204f070?cid=db3cb208eea947b9b5115eaba840402e', 'track_number': 1, 'type': 'track', 'uri': 'spotify:track:5wTVNpi5WDByxBgKgUE6MU'}, {'album': {'album_type': 'SINGLE', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/6qqNVTkY8uBg9cP3Jd7DAH'}, 'href': 'https://api.spotify.com/v1/artists/6qqNVTkY8uBg9cP3Jd7DAH', 'id': '6qqNVTkY8uBg9cP3Jd7DAH', 'name': 'Billie Eilish', 'type': 'artist', 'uri': 'spotify:artist:6qqNVTkY8uBg9cP3Jd7DAH'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'external_urls': {'spotify': 'https://open.spotify.com/album/7fRrTyKvE4Skh93v97gtcU'}, 'href': 'https://api.spotify.com/v1/albums/7fRrTyKvE4Skh93v97gtcU', 'id': '7fRrTyKvE4Skh93v97gtcU', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/ab67616d0000b273a9f6c04ba168640b48aa5795', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/ab67616d00001e02a9f6c04ba168640b48aa5795', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/ab67616d00004851a9f6c04ba168640b48aa5795', 'width': 64}], 'name': 'dont smile at me', 'release_date': '2017-12-22', 'release_date_precision': 'day', 'total_tracks': 9, 'type': 'album', 'uri': 'spotify:album:7fRrTyKvE4Skh93v97gtcU'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/6qqNVTkY8uBg9cP3Jd7DAH'}, 'href': 'https://api.spotify.com/v1/artists/6qqNVTkY8uBg9cP3Jd7DAH', 'id': '6qqNVTkY8uBg9cP3Jd7DAH', 'name': 'Billie Eilish', 'type': 'artist', 'uri': 'spotify:artist:6qqNVTkY8uBg9cP3Jd7DAH'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'disc_number': 1, 'duration_ms': 203569, 'explicit': False, 'external_ids': {'isrc': 'USUM71707712'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/41zXlQxzTi6cGAjpOXyLYH'}, 'href': 'https://api.spotify.com/v1/tracks/41zXlQxzTi6cGAjpOXyLYH', 'id': '41zXlQxzTi6cGAjpOXyLYH', 'is_local': False, 'name': 'idontwannabeyouanymore', 'popularity': 82, 'preview_url': 'https://p.scdn.co/mp3-preview/490212950b01e9f42b200a7a0134fee75a25480b?cid=db3cb208eea947b9b5115eaba840402e', 'track_number': 2, 'type': 'track', 'uri': 'spotify:track:41zXlQxzTi6cGAjpOXyLYH'}, {'album': {'album_type': 'ALBUM', 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/66CXWjxzNUsdJxJ2JdwvnR'}, 'href': 'https://api.spotify.com/v1/artists/66CXWjxzNUsdJxJ2JdwvnR', 'id': '66CXWjxzNUsdJxJ2JdwvnR', 'name': 'Ariana Grande', 'type': 'artist', 'uri': 'spotify:artist:66CXWjxzNUsdJxJ2JdwvnR'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'external_urls': {'spotify': 'https://open.spotify.com/album/3tx8gQqWbGwqIGZHqDNrGe'}, 'href': 'https://api.spotify.com/v1/albums/3tx8gQqWbGwqIGZHqDNrGe', 'id': '3tx8gQqWbGwqIGZHqDNrGe', 'images': [{'height': 640, 'url': 'https://i.scdn.co/image/ab67616d0000b273c3af0c2355c24ed7023cd394', 'width': 640}, {'height': 300, 'url': 'https://i.scdn.co/image/ab67616d00001e02c3af0c2355c24ed7023cd394', 'width': 300}, {'height': 64, 'url': 'https://i.scdn.co/image/ab67616d00004851c3af0c2355c24ed7023cd394', 'width': 64}], 'name': 'Sweetener', 'release_date': '2018-08-17', 'release_date_precision': 'day', 'total_tracks': 15, 'type': 'album', 'uri': 'spotify:album:3tx8gQqWbGwqIGZHqDNrGe'}, 'artists': [{'external_urls': {'spotify': 'https://open.spotify.com/artist/66CXWjxzNUsdJxJ2JdwvnR'}, 'href': 'https://api.spotify.com/v1/artists/66CXWjxzNUsdJxJ2JdwvnR', 'id': '66CXWjxzNUsdJxJ2JdwvnR', 'name': 'Ariana Grande', 'type': 'artist', 'uri': 'spotify:artist:66CXWjxzNUsdJxJ2JdwvnR'}], 'available_markets': ['AD', 'AE', 'AR', 'AT', 'AU', 'BE', 'BG', 'BH', 'BO', 'BR', 'CA', 'CH', 'CL', 'CO', 'CR', 'CY', 'CZ', 'DE', 'DK', 'DO', 'DZ', 'EC', 'EE', 'EG', 'ES', 'FI', 'FR', 'GB', 'GR', 'GT', 'HK', 'HN', 'HU', 'ID', 'IE', 'IL', 'IN', 'IS', 'IT', 'JO', 'JP', 'KW', 'LB', 'LI', 'LT', 'LU', 'LV', 'MA', 'MC', 'MT', 'MX', 'MY', 'NI', 'NL', 'NO', 'NZ', 'OM', 'PA', 'PE', 'PH', 'PL', 'PS', 'PT', 'PY', 'QA', 'RO', 'SA', 'SE', 'SG', 'SK', 'SV', 'TH', 'TN', 'TR', 'TW', 'US', 'UY', 'VN', 'ZA'], 'disc_number': 1, 'duration_ms': 172106, 'explicit': True, 'external_ids': {'isrc': 'USUM71808580'}, 'external_urls': {'spotify': 'https://open.spotify.com/track/0WdR2AyLW1Drd3OUdwezM0'}, 'href': 'https://api.spotify.com/v1/tracks/0WdR2AyLW1Drd3OUdwezM0', 'id': '0WdR2AyLW1Drd3OUdwezM0', 'is_local': False, 'name': 'everytime', 'popularity': 69, 'preview_url': 'https://p.scdn.co/mp3-preview/8b2ee40dbd918c0aacd4554c72f585bd27cf54f5?cid=db3cb208eea947b9b5115eaba840402e', 'track_number': 8, 'type': 'track', 'uri': 'spotify:track:0WdR2AyLW1Drd3OUdwezM0'}], 'total': 50, 'limit': 5, 'offset': 0, 'previous': None, 'href': 'https://api.spotify.com/v1/me/top/tracks?limit=5&offset=0&time_range=long_term', 'next': 'https://api.spotify.com/v1/me/top/tracks?limit=5&offset=5&time_range=long_term'}

        response = store_top_tracks(user_id, top_tracks)
        self.assertEqual(len(response), 5)

class TestUserMethods(unittest.TestCase):
    def setUp(self):
        init_db()

    def test_create_user(self):
        me = {'display_name': 'Ernest Lian', 'external_urls': {'spotify': 'https://open.spotify.com/user/ernest.lian97'}, 'followers': {'href': None, 'total': 13}, 'href': 'https://api.spotify.com/v1/users/ernest.lian97', 'id': 'ernest.lian97', 'images': [{'height': None, 'url': 'https://i.scdn.co/image/ab6775700000ee8526a6ebbfdc7621dece89f2d0', 'width': None}], 'type': 'user', 'uri': 'spotify:user:ernest.lian97'}
        response = create_user(me)

        self.assertEqual(response['body']['name'], 'Ernest Lian')

if __name__ == '__main__':
    unittest.main()
